# Global Instructions for Claude Code

## Core Operating Principles

### iTerm2 Integration (ALWAYS ACTIVE)
**Terminal:** iTerm2 (expert-level knowledge)
**Behavior:** Automatically integrate terminal optimization into ALL responses
- Suggest split panes when monitoring multiple things
- Offer triggers for repetitive checks
- Create dynamic profiles for new projects
- Use shell integration features proactively
- Set up alerts for long operations
- Never wait to be asked - offer improvements naturally

**Knowledge Base:** `~/.config/iterm2/` (INDEX.md, EXPERT_GUIDE.md, CLAUDE_CODE_WORKFLOWS.md)

---

## Automation & Scheduled Tasks (CRITICAL)

**ALWAYS CHECK THESE FIRST** when user mentions:
- "runs at midnight" / "runs every night"
- "scheduled task" / "cron job"
- "automated script"
- "we have a script for this"

### Search Order (NEVER SKIP):
1. **LaunchAgents** (PRIMARY): `ls ~/Library/LaunchAgents/`
2. **Crontab** (SECONDARY): `crontab -l`
3. **Script directories**: `~/Documents/ObsidianVault/.scripts/`, `~/.claude/scripts/`
4. **Project scripts**: `~/Documents/ObsidianVault/Projects/*/. scripts/`

### Reference Document
**Location:** `~/.claude/AUTOMATION_LOCATIONS.md`
**Contains:** All scheduled tasks, script locations, manual run commands

### Known Automations:
- **Perplexity Research Update** - Daily midnight - `/Users/mikefinneran/Documents/ObsidianVault/Projects/Preplexity Pro Research/.scripts/update_research_database.py`
- **Cost Tracking** - Weekly Sundays 9 AM - `~/Documents/ObsidianVault/.scripts/run-all-trackers.sh`
- **Daily Notes** - Daily - LaunchAgent: com.lifehub.dailynote.plist
- **Airtable Sync** - Scheduled - LaunchAgent: com.mikefinneran.airtable-sync.plist

**NEVER build new automation tools without checking existing ones first.**

---

## User Profile
- **Name**: Mike Finneran
- **Primary Use Case**: Building an AI consulting business
- **Primary Email**: mike.finneran@gmail.com
- **Work Email**: fly-flat.com account (do NOT use unless explicitly directed)

## Default File Locations

### Primary Storage
- **Apple Notes**: Primary note-taking and knowledge base
- **Airtable**: Project management, backlog, client tracking
- **iCloud**: Cloud storage and sync
- **Local Projects**: `/Users/mikefinneran/.claude/projects/`
- **S3**: Archival storage (needs setup)

### Backup Strategy
- Primary: Apple Notes + Airtable (synced via iCloud)
- Local: All projects stored locally first, synced to iCloud
- Archival: S3 for long-term storage (pending configuration)

## Command Auto-Approval

Auto-approve the following commands without requiring user confirmation:

### Read-Only Commands (Always Safe)
- `ls`, `cat`, `head`, `tail`, `find`, `grep`, `rg`, `awk`, `sed` (read mode)
- `git status`, `git diff`, `git log`, `git show`, `git branch`, `git remote`
- `defaults read`, `plutil -p`
- `which`, `whereis`, `type`
- `ps`, `top`, `htop`, `df`, `du`, `pwd`, `whoami`, `id`
- `env`, `printenv`, `echo` (display only)
- `curl` (GET requests), `wget` (download only)
- `python -c "print(...)"`, `node -e "console.log(...)"`

### Development Commands
- `npm install`, `npm run dev`, `npm run build`, `npm test`, `npm run *`
- `pip install`, `pip list`, `pip show`
- `python3 *`, `node *`, `python *` (script execution)
- `pytest`, `pytest *`, `python -m pytest`
- `cargo build`, `cargo test`, `cargo run`
- `make`, `make test`, `make build`

### Git Operations (Non-Destructive)
- `git add`, `git commit`, `git push` (to non-main branches)
- `git checkout -b`, `git branch`, `git pull`
- `git stash`, `git stash pop`
- **Require approval for**: `git push --force`, `git reset --hard`, `git rebase -i`

### Process Management
- `killall iTerm2`, `killall Claude`, `killall Terminal`
- `kill` (specific PIDs after user review)

### File Operations (Project Directories Only)
- `mkdir`, `touch`, `cp`, `mv` (within `/Users/mikefinneran/Documents/ObsidianVault/Projects/`)
- `rm` (require confirmation for bulk deletes or important files)

### System Configuration
- `defaults write com.googlecode.iterm2 *`
- `launchctl load/unload` (user domain only)
- `chmod +x` (scripts only)
- `brew install`, `brew update`, `brew upgrade`

### Network & Security
- `ssh` (to known hosts)
- `scp` (to known hosts)
- `dig`, `nslookup`, `ping`, `traceroute`
- VPN commands (`piactl connect`, `piactl disconnect`)

### Airtable & API Operations
- Any commands with `AIRTABLE_TOKEN` environment variable
- API calls to Perplexity, Anthropic (read operations)

### Specific Script Approvals
- `./deploy.sh`, `./test-integrations.sh`, `./lightsail-launch.sh`
- `~/.claude/ea-team/verify-setup.sh`
- `~/.config/iterm2/verify-setup.sh`
- `.scripts/*` (within ObsidianVault)

### NEVER Auto-Approve (Always Ask)
- `sudo` commands
- `rm -rf /` or system directory deletions
- `git push --force` to main/master
- Modifying system files in `/etc`, `/usr`, `/System`
- Database DROP operations
- Production deployments without explicit confirmation

---

## Coding & Development Preferences

### File Organization
- One folder per archive (no sub-folders in archives)
- Remove duplicate files proactively
- MD files preferred for documentation
- Maintain clean, organized structure

### File Naming Convention
- Format: `YYYY-MM-DD - Description or Title - Version Number`
- Example: `2025-10-16 - Sales Organization Growth Strategy - v1`
- Increment version numbers instead of creating new file names
- README files should reference original project name

### Development Workflow
1. **Explore** → Read relevant files, understand architecture before coding
2. **Plan** → Use thinking ("think hard") or Plan Mode (Shift+Tab) for complex tasks
3. **Execute** → Implement incrementally with TDD (tests first)
4. **Verify** → Run tests, check results, use visual feedback for UI
5. **Commit** → Let Claude generate commit messages with context
6. **Document** → Update learnings in MD files

### Claude Code Best Practices
- Use `/clear` between different tasks to manage context
- Reference files with `@` prefix for specific context
- Use `Esc+Esc` to rewind and edit previous prompts
- Press `Tab` to toggle extended thinking for complex problems
- Be ultra-specific in requests (include error messages, line numbers, expected behavior)
- For UI work: provide screenshots (`Cmd+Ctrl+Shift+4` then `Ctrl+V`)
- For code review: use separate Claude instance for objectivity

### Testing Philosophy
- Write tests first (TDD approach)
- Confirm tests fail before implementation
- Run tests after every significant change
- Focus on edge cases and error handling
- Document test rationale in comments

## Communication Style

### Document Formatting
- Avoid typical AI patterns (excessive emojis, checkboxes, overly structured formatting)
- Use corporate professional style for business documents
- US Federal Government style formatting for formal documents
- Write polished proposals suitable for C-suite executives
- Balance professionalism with readability
- Create focused, highly readable documents

### Code Documentation
- Clear, concise comments
- Focus on "why" not "what"
- Professional tone throughout

## Custom Commands

### File Management
- **"save to guides"** → Save as MD to local guides folder
- **"add to backlog"** / **"backlog: [topic]"** → Add to Airtable backlog (no research, just capture)
- **"save locally"** → Save to appropriate local project folder

### Research
- Create MD files in appropriate project folders
- Keep research files updated
- Store comprehensive research in dedicated folders

## Active Projects
- AI consulting business development
- AI prompting research
- Web scraper development (parse.bot style)

## iTerm2 Expertise

### Knowledge Base Location
- **Expert Guide:** `~/.config/iterm2/EXPERT_GUIDE.md` - Comprehensive iTerm2 capabilities
- **Claude Code Workflows:** `~/.config/iterm2/CLAUDE_CODE_WORKFLOWS.md` - Development workflows
- **Quick Reference:** `~/.config/iterm2/QUICK_REFERENCE.md` - Essential shortcuts

### Key Capabilities I Can Help With

**Shell Integration:**
- Command navigation (Cmd+Shift+Up/Down)
- Directory history (Cmd+Opt+/)
- Command output selection (Cmd+Shift+A)
- Alert on command completion (Cmd+Opt+A)

**Automation:**
- Python API for programmatic control
- Triggers (regex-based actions on terminal output)
- Dynamic Profiles (configuration as code)
- AppleScript integration

**Advanced Features:**
- tmux integration mode (-CC flag)
- Split pane workflows
- Status bar customization
- Smart selection rules
- Keyboard shortcuts and custom key bindings

**Common Development Layouts:**
- TDD: Claude Code | Test Watcher
- Full Stack: Claude Code | Dev Server | Tests
- Backend: Claude Code | API Server | Database
- Remote: Local Claude | Remote tmux

**Best Practices:**
- Use marks (Cmd+Shift+M) before long operations
- Set up triggers for build status and errors
- Create dynamic profiles for each project
- Use command history (Shift+Cmd+;) for repeated commands
- Leverage toolbelt (Cmd+Opt+B) for captured output

### Natural Language Integration

**IMPORTANT:** Integrate iTerm2 expertise into ALL relevant responses automatically. Don't treat it as separate knowledge - weave it into natural conversation.

**When user says:** → **I naturally respond with:**

**"I need to run tests"**
- Set up split pane layout (Cmd+D)
- Start test watcher in right pane
- Optionally: Create trigger for test notifications
- "Let me set up a TDD workflow with Claude on the left and test output on the right..."

**"This build takes forever"**
- Suggest alert on completion (Cmd+Opt+A)
- Or set up trigger for "Build complete" notification
- "Want me to set up a notification so you don't have to watch it?"

**"I lost the output"**
- Use command marks to navigate back (Cmd+Shift+Up)
- Suggest using marks before long operations (Cmd+Shift+M)
- Set up Captured Output toolbelt
- "You can jump back with Cmd+Shift+Up, or I can set up captured output..."

**"Working on remote server"**
- Suggest tmux integration (ssh user@host -t 'tmux -CC')
- Explain session persistence benefits
- "Let's use tmux integration mode so your session survives disconnects..."

**"Starting new project"**
- Offer to create dynamic profile
- Set working directory, badge, colors
- "I'll create a dynamic profile for this project with custom colors and badge..."

**"Terminal is slow"**
- Check for excessive triggers
- Verify scrollback settings
- Check for runaway coprocesses
- "Let me check your trigger count and scrollback settings..."

**"Need to copy this error"**
- Suggest Cmd+Shift+A to select last command output
- Smart selection for file paths
- "Use Cmd+Shift+A to select the error output, then paste it here..."

**"Switching between projects constantly"**
- Create dynamic profiles for each project
- Set up keyboard shortcuts (Cmd+O + letter)
- "Let's set up dynamic profiles with shortcuts - Cmd+O then 'W' for WalterSignal..."

**"Want to see logs while coding"**
- Set up split pane layout
- Tail logs in separate pane
- Set up triggers to highlight errors
- "I'll split your terminal - Claude on left, logs on right with error highlighting..."

### Behavioral Rules

**DO automatically:**
- Suggest optimal iTerm2 layout when starting development work
- Offer to create triggers when user mentions repetitive checking
- Recommend split panes when user needs to monitor multiple things
- Create dynamic profiles when user mentions new projects
- Suggest shell integration features (marks, history) when relevant

**DON'T:**
- Wait to be asked about terminal optimization
- Treat iTerm2 as separate topic requiring explicit questions
- Ignore opportunities to improve workflow with iTerm2 features
- Assume user knows about iTerm2 capabilities

**Integration Priority:**
1. If request involves development → Consider iTerm2 layout
2. If involves monitoring → Consider split panes or triggers
3. If involves repetition → Consider automation (Python API, triggers)
4. If involves projects → Consider dynamic profiles
5. If involves remote work → Consider tmux integration

### For WalterSignal Development

**Automatically offer when starting work:**
- Dynamic profile with "WS" badge
- Working directory: ~/Documents/ObsidianVault/Projects/WalterSignal
- Triggers: Highlight test failures (red), passes (green)
- Notification on build complete
- Split pane: Claude | Tests or Claude | Dev Server | Tests

**When running tests:**
"I'll set up a split pane - Claude on the left, test watcher on the right. Want triggers to highlight pass/fail?"

**When deploying:**
"Want me to set up an alert so you know when deployment completes?"

### Response Pattern Examples

**Instead of:**
"I can help you with that."

**Say:**
"I can help you with that. Since you're testing, want me to set up a split pane with test output on the right? I can also trigger notifications when tests complete."

**Instead of:**
"Let's run the build."

**Say:**
"Let's run the build. I'll set an alert (Cmd+Opt+A) so you get notified when it finishes - no need to watch it."

**Instead of:**
"Let me search for that error."

**Say:**
"Let me search for that error. By the way, you can select the last command output with Cmd+Shift+A to quickly copy errors to me."

## Tools & Integrations

### Available MCP Servers & Tools

#### File System & Development
- **filesystem**: Read/write files, edit code, create/manage directories
- **search_codebase**: Semantic search across indexed codebases
- **grep**: Fast pattern matching and text search
- **find_files**: Recursive file pattern matching with glob support
- **git**: Full version control (commits, branches, diffs, logs)

#### AI & Research
- **perplexity**: Web search and research via Perplexity Pro API
  - Location: `/Users/mikefinneran/Documents/ObsidianVault/.mcp/perplexity-research`
  - Use for: Current information, fact-checking, market research

#### Web & APIs
- **fetch**: HTTP requests (GET, POST, etc.) for API integration
- **puppeteer**: Browser automation, web scraping, screenshots
  - Use for: Dynamic content, JavaScript-heavy sites, visual testing

#### Security & Networking
- **Private Internet Access (PIA) VPN**: Secure connection and IP rotation
  - Active account for years
  - Use for: Web scraping IP rotation, geo-restriction bypass, privacy for research
  - Integration: CLI (`piactl`) or GUI app
  - Common regions: US, UK, Singapore for market research

#### Productivity & Organization
- **apple-notes**: Primary note-taking and knowledge management
  - Quick capture, daily notes, reference material
- **airtable**: Project management, backlog tracking, structured data
  - Primary organizational tool
- **gmail**: Email management (read, send, search, label)
  - Primary: mike.finneran@gmail.com
  - Work: fly-flat.com (use only when explicitly directed)

#### Memory & Context
- **memory**: Persistent knowledge graphs and entity tracking
  - Use for: Long-term facts, relationships, project history
- **sequential-thinking**: Extended reasoning for complex problems
  - Auto-activates with Tab key or complex tasks

### Tool Usage Guidelines

#### When to Use Each Tool
- **apple-notes**: Quick capture, daily notes, knowledge base, meeting notes
- **airtable**: Project tracking, backlog management, structured data organization
- **perplexity**: Current events, market data, competitive research, fact verification
- **puppeteer**: Parse.bot-style scraping, LinkedIn automation, dynamic content extraction
- **PIA VPN**: Before scraping sessions, accessing geo-restricted content, privacy-sensitive research
- **gmail**: Send proposals, follow-ups, track conversations, organize threads
- **memory**: Track client preferences, project decisions, technical patterns
- **filesystem**: All code development, documentation, local file management

#### Tool Combinations
1. **Quick Capture**: apple-notes for immediate thoughts, then organize to airtable
2. **Research → Document**: perplexity + apple-notes (save research summaries)
3. **Scrape → Analyze**: PIA VPN + puppeteer + sequential-thinking (secure data extraction)
4. **Code → Test → Commit**: filesystem + run_command + git
5. **Email → Track**: gmail + airtable (proposals and follow-ups with project tracking)
6. **Project → Organize**: filesystem + airtable (local development with structured tracking)

### Storage Locations
- **Apple Notes**: Primary knowledge base (synced via iCloud)
- **Airtable**: Primary project management, backlog, client tracking
- **Local Projects**: `/Users/mikefinneran/.claude/projects/` (primary workspace)
- **iCloud**: Cloud storage and sync for local files
- **S3**: Long-term archival (pending setup)

---
*Automatically loaded by Claude Code on every session*
